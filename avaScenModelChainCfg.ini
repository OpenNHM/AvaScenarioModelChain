# ------------------------------------------------------------------------------
# Avalanche Scenario Model Chain – Configuration File
# ------------------------------------------------------------------------------
#
# Purpose :
#     Central configuration for the Avalanche Scenario Model Chain (Steps 00–15).
#     Controls all preprocessing, PRA generation, FlowPy simulation, and
#     AvaDirectory building through a unified parameter and workflow structure.
#
# Structure :
#     [MAIN]          Project metadata, paths, input rasters, and global settings
#     [WORKFLOW]      Step activation flags (PRA, FlowPy, AvaDirectory)
#     [pra*]          PRA delineation, filtering, segmentation, elevation/size
#     [avaPARAMETER]  FlowPy parameter generation (Step 09)
#     [avaSIZE]       Size back-mapping rules for FlowPy outputs (Step 11)
#     [avaDIRECTORY]  Avalanche Directory building and enrichment (Steps 13–15)
#     [PLOTS]         Optional visualization parameters
#
# Usage :
#     - Place this file next to runAvaScenModelChain.py
#     - For project-specific overrides create:
#           local_avaScenModelChainCfg.ini
#       (Local file always takes priority if present.)
#
# Notes :
#     - All paths must be absolute or relative to the project workDir.
#     - Only modify identifiers where explicitly documented—many are
#       consumed across multiple steps.
#     - Step switches in [WORKFLOW] allow full/partial reruns with unified
#       resume logic.
#
# Author :
#     Christoph Hesselbach
#
# Institution :
#     Austrian Research Centre for Forests (BFW)
#     Department of Natural Hazards | Snow and Avalanche Unit
#
# Date & Version :
#   2025-11 - 1.0
#
# ------------------------------------------------------------------------------


[MAIN]
initWorkDir = True
workDir = path/to/your/workDir
project = projectName
ID = prijectID
DEM = 10DTM_<name>.tif
FOREST = 10nDOM_binAgg_100_<name>_forestCom.tif
BOUNDARY = region<name>.geojson
COMMISSIONREGION = commRegionExtent<name>.geojson
COMMISSIONS = commissionsEuregio.geojson
AVAREPORT = avaReportMicroRegions.geojson


[WORKFLOW]
### all PRA steps
runAllPRASteps = True
# single PRA steps
praDelineation = False
praSelection = False
praBottleneckSmoothing = False
praSubCatchments = False
praProcessing = False
praSegmentation = False
praAssignElevSize = False
praPrepForFlowPy = False
praMakeBigDataStructure = False

### all FlowPy steps
runAllFlowPySteps = True
# single FlowPy steps
flowPyInputToSize = False
flowPyRun = False
flowPyOutputToSize = False
flowPyOutputCompress = False
flowPyDOutputDeleteOGFiles = False
flowPyDeleteTempFolder = False

### all AvaDirectory steps
runAllAvaDirSteps = True
# single AvaDirectory steps
avaDirBuildFromFlowPy = False  
avaDirType = False              
avaDirResults = False       

#test only 
makeSingleTestRun = True
singleTestDir = pra030secE-1800-2000-4


[praDELINEATION]
forestType = pcc
saveAllThresholds = False
singleThreshold = 0.30
radius = 6
prob = 0.5
winddir = 0
windtol = 180


[praSELECTION]
selectedThreshold = 0.30
minElev = 0
maxElev = 4000
aspectSector = all
maskCommRegion = True


[praBOTTLENECKSMOOTHING]
## tbc


[praSUBCATCHMENTS]
streamThreshold = 500
minLength = 100
smoothingWindowSize = 5
weightedSlopeFlow = False


[praPROCESSING]
minDirectNeighborsPass1 = 3
minDiagonalNeighborsPass2 = 2
outputCompression = LZW
maskNoDataValue = 0


[praSEGMENTATION]
sizeClass1 = 0,500
sizeClass2 = 500,2500
sizeClass3 = 2500,12500
sizeClass4 = 12500,62500
sizeClass5 = 62500,inf
sizeFilter = 500


[praASSIGNELEV]
elevationBand1 = 0,1800
elevationBand2 = 1800,2000
elevationBand3 = 2000,2200
elevationBand4 = 2200,2400
elevationBand5 = 2400,5000


[praPREPFORFLOWPY]
compressOutputs = True
# PRA vectorization/rasterization modes
enableRasterizePRA = True
rasterizeModePRA = attribute
# ID vectorization/rasterization modes
rasterizeAttributePRA = praAreaM
enableRasterizeID = True
rasterizeAttributeID = praID
# calculate boundaries for FlowPy efficiency
deriveBoundaries = False


[praMAKEBIGDATASTRUCTURE]
usePraBoundary = False
# min / max dry size class
minDrySizeClass = 2
maxDrySizeClass = 5
# min / max wet size class (no wet size 5)
minWetSizeClass = 2
maxWetSizeClass = 4
logDirectoryTree = False


[avaPARAMETER]
flowTypes = dry, wet
sizeRange = 2-5


[avaSIZE]
# Rel vol size dependent parametrization for
# > dry:
sizeMax = 5
alphaSize2 = 32
deltaAlpha = 3
uMaxSize2 = 8
deltaUMax = 18
constantExp = True
constantExpValue = 12
constantPraThickness = True
praThickness = 1

# Rel vol size dependent parametrization shift for
# > wet:
alphaDependendTemperature = True
sizeShiftAlpha = 0.5
sizeShiftUmax = -0.75
sizeShiftExp = 12

# Results to size 
resParamsToSize = zDelta|travelLengthMax|fpTravelAngleMax

# snow climate (not used ATM)
D0 = 0
deltaD = 0.001
constantTemperature = True
Tcons = -11
T0 = 0
deltaT = -0.01
TCold = -11
TWarm = -1


[avaDIRECTORY]
# core run control
runAll = True                 

# processing flags
doProcess = True              
doSplit = True               
doMergeReljson = True         
doEnrich = True              
doExtractMetadata = True     
doClipRasters = True          
doCollectSingleAva = True     

# tuning
maxClipWorkers = 4            

# rebuild behaviour
forceRebuildIndex = False
forceRebuildResults = False








[PLOTS]
ARel =
plotExponent = True
elevationMin = 100
elevationMax = 3000
theta = 35
d = 2
